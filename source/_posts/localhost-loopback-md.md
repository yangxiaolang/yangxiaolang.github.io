---
title: 0.0.0.0 & 127.0.0.1 & 本机IP的差别
date: 2022-03-31 14:13:38
tags:
  - 计算机网络
  - 部署
---

同事在部署项目到部署环境上启动验证的时候，使用 curl 访问本机 IP 的时候 Connection refused 的了。因为 HTTP 服务启动时监听的 Host 是 127.0.0.1,导致了只有目的地址是 127.0.0.1 的请求才能被进程处理。借此也了解学习了一下 0.0.0.0 & 127.0.0.1 & 本机 IP 的差别。

## 地址对比

### 0.0.0.0

代表的是本机所有 IP 地址,无论主机绑定了多少 IP 地址,只要监听了本机的 0.0.0.0 上的端口，就等于监听机器上的所有 IP 的该端口。只要发往该端口 **HTTP 报文的目的地址 IP 是主机的任一 IP**，就可以被接收。

### 127.0.0.1

是[环回地址（Loopback Address）](https://baike.baidu.com/item/%E5%9B%9E%E9%80%81%E5%9C%B0%E5%9D%80/8021522),代表本地主机。发往环回地址的请求，会在 **IP 层**短路，不再向下传递，而是立即返回。一般用于网络软件测试或进程间通信。
需要注意的是，如果进程监听的是本机的 127.0.0.1 上的端口，那么只有 **HTTP 报文的目的地址 IP 是 127.0.0.1 的请求才可以被接收**。

### 本机 IP

本机 IP 是开放的 IP 地址，在网络中代表本机的 IP 地址，可通过这些 IP 地址远程访问或控制主机。进程的监听效果跟 127.0.0.1 相同，只 **HTTP 报文的目的地址 IP 是 进程监听的本机 IP** 的请求才可以被接收。

### localhost

**localhost 不是 IP 地址，而是一个在本地的 hosts 文件里定义好解析后 IP 的域名**，一般解析为 127.0.0.1，所以一般将其作为“本地主机”。

### 总结

- 127.0.0.1 和 localhost 代表本地主机，发送到该目的地址的请求不参与网络传输，一般只用于本地测试。
- 0.0.0.0 和本机 IP 代表网络中的本机，本机 IP 是主机多个 IP 中的一个，0.0.0.0 代表主机所有的 IP。

## 程序验证

其实这种问题很少遇到，一般网络框架都会对监听的 Host 有一个缺省值，即 0.0.0.0，除非指定了 host。下面就是通过显式声明来指定进程监听的 host 来验证。

```javascript
// 验证代码
var http = require("http");

const host = "127.0.0.1";
const port = 8080;
http
  .createServer(function (request, response) {
    response.write("You can access me!\n");
    response.end();
  })
  .listen(port, host);
console.log(`Server running at http://${host}:${port}/`);
```

测试环境使用 windows 和 wsl 作为同一局域网下的两台主机,wsl 运行验证程序,同样使用 curl 进行验证。
